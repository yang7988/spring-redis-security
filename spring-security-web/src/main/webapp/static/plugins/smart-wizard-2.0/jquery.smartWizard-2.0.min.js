(function(e){function t(t,n){var r=e.data(t,"smartWizard").actionBar;var i=e.data(t,"smartWizard").fakeNext;i.click()}function n(t){var n=e.data(t,"smartWizard").actionBar;var r=e.data(t,"smartWizard").realNext;r.click()}e.fn.smartWizard=function(t,n){if(typeof t=="string"){return e.fn.smartWizard.methods[t](this,n)}var r=e.extend({},e.fn.smartWizard.defaults,t);var i=arguments;return this.each(function(){function b(){var t=n.children("div");l=n.children("ul").addClass("anchor");t.addClass("content").addClass("autoheight");a=e("<div>Loading</div>").addClass("loader");c=e("<div></div>").addClass("actionBar");p=e("<div></div>").addClass("stepContainer");d=w(r.labelNext,r.btNextCssClass,"button-next");v=w(r.labelNext,r.btNextCssClass,"",true);m=w(r.labelPrevious,r.btPreviousCssClass,"button-previous");g=w(r.labelFinish,r.btFinishCssClass,"button-finish");if(r.errorSteps&&r.errorSteps.length>0){e.each(r.errorSteps,function(e,t){_(t,true)})}p.append(t);c.append(a);if(r.showAnchor){h=e("<div></div>").addClass("horizontal-separator");n.append(h)}n.append(p);p.append(c);if(r.includeFinishButton){c.append(g)}c.append(m).append(d).append(v);u=p.width();D();e(d).click(function(){if(e(this).hasClass("buttonDisabled")){return false}if(e.isFunction(r.onBeforeNext)){var t=o.eq(s);if(!r.onBeforeNext.call(this,t)){return false}}return false});e(v).click(function(){if(e(this).hasClass("buttonDisabled")){return false}L();return false});e(m).click(function(){if(e(this).hasClass("buttonDisabled")){return false}A();return false});e(g).click(function(){if(!e(this).hasClass("buttonDisabled")){if(e.isFunction(r.onFinish)){if(!r.onFinish.call(this,e(o))){return false}}else{var t=n.parents("form");if(t&&t.length){t.submit()}}}return false});e(o).bind("click",function(e){return false});e(window).bind("resize",function(){D()});if(r.keyNavigation){e(document).keyup(function(e){if(e.which==39){L()}else if(e.which==37){A()}})}if(!r.showNavigation){l.hide()}e.data(n[0],"smartWizard",{anchor:l,actionBar:c,stepContainer:p,fakeNext:d,realNext:v,previous:m});E();N(s);S(s);r.onLoadComplete.call()}function w(t,n,r,i,s,o){var u,a;if(!s){a=e('<a class="easyui-linkbutton l-btn"><span class="l-btn-left"></span></a>').attr("href","#").addClass(r);var f=e(".l-btn-left",a);var l=e('<span class="l-btn-text" style="padding-left: 20px;">'+t+"</span>").addClass(n);f.append(l)}else{a=e('<a class="c-l-btn"></a>').html(t).addClass(r)}if("button-next"==r){a.addClass("right_icon")}u=e("<div></div>").append(a).addClass("buttonWrapper");if(o){u.attr("id",o)}if(i){u.css("display","none")}return u}function E(){if(!r.enableAllSteps){if(r.showAnchor){e(o,n).removeClass("selected").removeClass("done").addClass("disabled")}e(o,n).attr("isDone",0)}else{if(r.showAnchor){e(o,n).removeClass("selected").removeClass("disabled").addClass("done")}e(o,n).attr("isDone",1)}e(o,n).each(function(t){if(r.showAnchor){if(t===0){x(e(this))}else if(t===o.length-1){T(e(this))}}e(e(this).attr("href"),n).hide();e(this).attr("rel",t+1)})}function S(t){var i=e.data(n[0],"smartWizard");if(r.stepsButton&&r.stepsButton[t]){c.empty();if(r.stepsButton[t].previous){m=w(r.stepsButton[t].previous.labelText||"上一步",r.stepsButton[t].previous.btCssClass||"icon-pre",r.stepsButton[t].previous.btOuterCssClass||"button-previous",false,r.stepsButton[t].previous.customizeBtn,r.stepsButton[t].previous.id);c.append(m);e(m).click(function(){if(e(this).hasClass("buttonDisabled")){return false}A();return false});i.previous=m}if(r.stepsButton[t].next){d=w(r.stepsButton[t].next.labelText||"下一步",r.stepsButton[t].next.btCssClass||"icon-next",r.stepsButton[t].next.btOuterCssClass||"button-next",false,r.stepsButton[t].next.customizeBtn);v=w(r.stepsButton[t].next.labelText,r.stepsButton[t].next.btCssClass,"",true,r.stepsButton[t].next.id);c.append(d).append(v);e(d).click(function(){if(e(this).hasClass("buttonDisabled")){return false}if(e.isFunction(r.onBeforeNext)){var t=o.eq(s);if(!r.onBeforeNext.call(this,t)){return false}}return false});e(v).click(function(){if(e(this).hasClass("buttonDisabled")){return false}L();return false});i.realNext=v;i.fakeNext=d}if(r.includeFinishButton&&r.stepsButton[t].finish){g=w(r.stepsButton[t].finish.labelText||"提交",r.stepsButton[t].finish.btCssClass||"icon-ok",r.stepsButton[t].finish.btOuterCssClass||"button-finish");c.append(g);e(g).click(function(){if(!e(this).hasClass("buttonDisabled")){if(e.isFunction(r.onFinish)){if(!r.onFinish.call(this,e(o))){return false}}else{var t=n.parents("form");if(t&&t.length){t.submit()}}}return false})}}}function x(e){if(r.firstStepHoverCssClass){e.addClass(r.firstStepHoverCssClass)}}function T(e){if(r.lastStepCssClass){e.addClass(r.lastStepDisabledCssClass)}}function N(t){var i=o.eq(t);var s=r.contentURL;var u=i.data("hasContent");c.hide();stepNum=t+1;if(s&&s.length>0){if(r.contentCache&&u){C(t)}else{e.ajax({url:s,type:"POST",data:{step_number:stepNum},dataType:"text",beforeSend:function(){a.show()},error:function(){a.hide()},success:function(r){a.hide();if(r&&r.length>0){i.data("hasContent",true);e(e(i,n).attr("href"),n).html(r);C(t)}}})}}else{C(t)}}function C(t){var i=o.eq(t);var a=o.eq(s);a.attr("sel",t);if(t!=s){if(e.isFunction(r.onLeaveStep)){if(!r.onLeaveStep.call(this,e(a))){c.show();return false}}}if(r.updateHeight)D();if(r.transitionEffect=="slide"){e(e(a,n).attr("href"),n).slideUp("fast",function(r){e(e(i,n).attr("href"),n).slideDown("fast");s=t;k(a,i)})}else if(r.transitionEffect=="fade"){e(e(a,n).attr("href"),n).fadeOut("fast",function(r){e(e(i,n).attr("href"),n).fadeIn("fast");s=t;k(a,i)})}else if(r.transitionEffect=="slideleft"){var f=0;var l=0;if(t>s){nextElmLeft1=u+10;nextElmLeft2=0;l=0-e(e(a,n).attr("href"),n).outerWidth()}else{nextElmLeft1=0-e(e(i,n).attr("href"),n).outerWidth()+20;nextElmLeft2=0;l=10+e(e(a,n).attr("href"),n).outerWidth()}if(t==s){nextElmLeft1=e(e(i,n).attr("href"),n).outerWidth()+20;nextElmLeft2=0;l=0-e(e(a,n).attr("href"),n).outerWidth()}else{e(e(a,n).attr("href"),n).animate({left:l},"fast",function(t){e(e(a,n).attr("href"),n).hide()})}e(e(i,n).attr("href"),n).css("left",nextElmLeft1);e(e(i,n).attr("href"),n).show();e(e(i,n).attr("href"),n).animate({left:nextElmLeft2},"fast",function(e){s=t;k(a,i)})}else{e(e(a,n).attr("href"),n).hide();e(e(i,n).attr("href"),n).show();s=t;k(a,i)}if(e(i,n).attr("showPrev")=="true"){e(m,c).show()}else{e(m,c).hide()}return true}function k(t,i){e(t,n).removeClass("selected");e(t,n).addClass("done");e(i,n).removeClass("disabled");e(i,n).removeClass("done");e(i,n).addClass("selected");e(i,n).attr("isDone",1);O();P(e(i).attr("actionbar-style"),e(i).attr("actionbar-width"));H(i,e(i).attr("contentAutoHeight"));if(parseInt(e(i).attr("rel"))>1){B(e(t),e(i))}if(e.isFunction(r.onShowStep)){if(!r.onShowStep.call(this,e(i))){return false}}}function L(){var e=s+1;if(o.length<=e){if(!r.cycleSteps){return false}e=0}N(e);S(e)}function A(){var e=s-1;if(0>e){if(!r.cycleSteps){return false}e=o.length-1}N(e);S(e)}function O(){if(!r.cycleSteps){if(0>=s){e(m).addClass("buttonDisabled")}else{e(m).removeClass("buttonDisabled")}if(o.length-1<=s){e(d).hide()}else{e(d).removeClass("buttonDisabled")}}if(!o.hasClass("disabled")||r.enableFinishButton){e(g).removeClass("buttonDisabled")}else{e(g).addClass("buttonDisabled")}if(o.length-1>s){e(g).hide()}else{e(g).show()}}function M(t){e(".content",f).html(t);f.show()}function _(t,r){if(r){e(o.eq(t-1),n).addClass("error")}else{e(o.eq(t-1),n).removeClass("error")}}function D(){var t,n,i,s=0;var o=0;if(r.heightDifference){o=r.heightDifference}n=e("body").outerHeight();if(l.length==0){i=0}else{i=l.outerHeight()}if(c.length==0){s=0}else{s=c.outerHeight()}t=n-i-o;t=t<=0?300:t;e(".autoheight",p).each(function(){e(this).css({height:"auto"})});if(r.stepContainerHeight){p.css("height",r.stepContainerHeight)}else{p.height(t)}}function P(e,t){if(e!=""){c.attr("style",e)}if(t&&t==="auto"){c.width(p.width())}if(s<o.length-1||s===o.length-1&&r.includeFinishButton){c.show()}}function H(t,r){if(r=="false"){e(e(t,n).attr("href"),n).removeClass("autoheight");e(e(t,n).attr("href"),n).height("100%")}}function B(e,t){if(e.attr("rel")==="1"&&r.firstStepCssClass){e.removeClass("firststep-selected");e.addClass(r.firstStepCssClass)}if(t.attr("rel")==o.length&&r.lastStepHoverCssClass){t.removeClass("laststep-disabled");t.addClass(r.lastStepHoverCssClass)}if(t.attr("rel")==1&&r.firstStepHoverCssClass){t.removeClass(r.firstStepCssClass);t.addClass(r.firstStepHoverCssClass)}}var n=e(this);var s=r.selected;var o=e("ul > li > a[href^='#step-']",n);var u=0;var a,f,l,c,h,p,d,v,m,g;c=e(".actionBar",n);if(c.length==0){c=e("<div></div>").addClass("actionBar")}h=e(".horizontal-separator",n);if(h.length==0&&r.showAnchor){h=e("<div></div>").addClass("horizontal-separator")}f=e(".msgBox",n);if(f.length==0){f=e('<div class="msgBox"><div class="content"></div><a href="#" class="close">X</a></div>');c.append(f)}e(".close",f).click(function(){f.fadeOut("normal");return false});if(!t||t==="init"||typeof t==="object"){b()}else if(t==="showMessage"){var y=Array.prototype.slice.call(i,1);M(y[0]);return true}else if(t==="setError"){var y=Array.prototype.slice.call(i,1);_(y[0].stepnum,y[0].iserror);return true}else{e.error("Method "+t+" does not exist")}})};e.fn.smartWizard.methods={nextStep:function(e,n){return e.each(function(){t(this,n)})},doForward:function(e,t){return e.each(function(){n(this)})}};e.fn.smartWizard.defaults={showNavigation:true,contentAutoHeight:true,selected:0,keyNavigation:false,enableAllSteps:false,updateHeight:true,transitionEffect:"fade",contentURL:null,contentCache:true,cycleSteps:false,includeFinishButton:true,enableFinishButton:false,errorSteps:[],labelNext:"Next",labelPrevious:"Previous",labelFinish:"Finish",onBeforeNext:null,onLeaveStep:null,onShowStep:null,onFinish:null,btNextCssClass:"icon-next",btPreviousCssClass:"icon-previous",btFinishCssClass:"icon-ok",heightDifference:1,firstStepCssClass:"firststep-done",firstStepHoverCssClass:"firststep-selected",lastStepCssClass:"laststep-done",lastStepHoverCssClass:"laststep-selected",lastStepDisabledCssClass:"laststep-disabled",stepsButton:undefined,showAnchor:true,onLoadComplete:function(){}}})(jQuery)